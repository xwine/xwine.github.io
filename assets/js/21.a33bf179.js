(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{218:function(a,t,s){"use strict";s.r(t);var n=s(0),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"线上问题排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线上问题排查","aria-hidden":"true"}},[a._v("#")]),a._v(" 线上问题排查")]),a._v(" "),s("ul",[s("li",[a._v("首先需要理解服务器各项指标含义和边界值")])]),a._v(" "),s("h2",{attrs:{id:"服务器指标（待整理）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器指标（待整理）","aria-hidden":"true"}},[a._v("#")]),a._v(" 服务器指标（待整理）")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("查看服务CPU和内存固定大小\n"),s("code",[a._v("cat /proc/cpuinfo")]),a._v(" "),s("code",[a._v("cat /proc/meminfo")])])]),a._v(" "),s("li",[s("p",[a._v("系统负载 通过"),s("code",[a._v("uptime")]),a._v("命令查看 ，它表示1分钟内： 总任务数/CPU能执行的任务数")])])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("~$ uptime\n 20:57:07 up 1093 days, 20:39,  1 user,  load average: 14.87, 15.34, 13.86\n")])])]),s("p",[a._v("正常值应该在 （CPU核数*0.7）左右")]),a._v(" "),s("ul",[s("li",[a._v("CPU利用率 90%")]),a._v(" "),s("li",[a._v("内存占用 80%")]),a._v(" "),s("li",[a._v("\bTCP连接数")]),a._v(" "),s("li",[a._v("磁盘使用率")])]),a._v(" "),s("h2",{attrs:{id:"定位耗用资源严重的代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定位耗用资源严重的代码","aria-hidden":"true"}},[a._v("#")]),a._v(" 定位耗用资源严重的代码")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("确定容器内存大小 CPU核数，JVM参数")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("top")]),a._v("命令查看所有进程情况可以直接取出PID，或者可以通过 "),s("code",[a._v("ps -aux")]),a._v(" 查看快照 获取到 PID 和进程所在的文件路径")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("top -Hp 1451 -d888")]),a._v(" 查看 "),s("code",[a._v("PID")]),a._v(" 为 "),s("code",[a._v("1451")]),a._v("下的所有线程，获取到资源占用最多的PID(线程id) "),s("code",[a._v("-d888")]),a._v(" 代表快照888秒刷新一次\n可键盘按大写 P 按照CPU使用排序，  大写 M 按照内存使用排序\n获取到线程ID"),s("code",[a._v("1452")])])]),a._v(" "),s("li",[s("p",[a._v("将"),s("code",[a._v("1452")]),a._v("转换成十六进制 "),s("code",[a._v("5ac")])])]),a._v(" "),s("li",[s("p",[s("code",[a._v("jstack 1451 | grep 5ac -A 30")]),a._v("  其中"),s("code",[a._v("1451")]),a._v("为进程ID，"),s("code",[a._v("1452")]),a._v("为线程ID\n"),s("code",[a._v("grep 5ac -A 30")]),a._v(" 代表从匹配"),s("code",[a._v("5ac")]),a._v("位置开始打印往后的30行 "),s("code",[a._v("-B")]),a._v("代表往前，"),s("code",[a._v("-C")]),a._v("代表前后各n行\n正常服务器可能没有执行该命令权限，可通过下载jstack文件，在文件中搜索关键词"),s("code",[a._v("5ac")])])]),a._v(" "),s("li",[s("p",[a._v("最后得到的结果：")])])]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" #"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" prio"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" os_prio"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" tid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x00007ff1e0008800")]),a._v(" nid"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x5ac")]),a._v(" waiting on condition "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x00007ff1e6697000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n   java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("State")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" TIMED_WAITING "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("sleeping"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\tat java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Native")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\tat com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("me"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("确定是 "),s("code",[a._v("com.github.me.Main.main(Main.java:7)")]),a._v("这里以后，可通过阅读代码找到问题。")])])}),[],!1,null,null,null);t.default=e.exports}}]);