<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>spring-aop | xwine</title>
    <meta name="description" content="THE BEST TIME IS NOW">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.8e89f972.css" as="style"><link rel="preload" href="/assets/js/app.e3e8a4f2.js" as="script"><link rel="preload" href="/assets/js/2.53d3f055.js" as="script"><link rel="preload" href="/assets/js/31.029347d6.js" as="script"><link rel="prefetch" href="/assets/js/10.eed22b54.js"><link rel="prefetch" href="/assets/js/11.20d4dce6.js"><link rel="prefetch" href="/assets/js/12.df3d0fb3.js"><link rel="prefetch" href="/assets/js/13.e7adab27.js"><link rel="prefetch" href="/assets/js/14.f0924b76.js"><link rel="prefetch" href="/assets/js/15.00601bcd.js"><link rel="prefetch" href="/assets/js/16.431f60c9.js"><link rel="prefetch" href="/assets/js/17.6cd51b48.js"><link rel="prefetch" href="/assets/js/18.9992f2f3.js"><link rel="prefetch" href="/assets/js/19.f9056bf7.js"><link rel="prefetch" href="/assets/js/20.b7c10170.js"><link rel="prefetch" href="/assets/js/21.a33bf179.js"><link rel="prefetch" href="/assets/js/22.55e0d477.js"><link rel="prefetch" href="/assets/js/23.25460b11.js"><link rel="prefetch" href="/assets/js/24.81c7b086.js"><link rel="prefetch" href="/assets/js/25.f1f12557.js"><link rel="prefetch" href="/assets/js/26.3fe0f6a4.js"><link rel="prefetch" href="/assets/js/27.9e45af44.js"><link rel="prefetch" href="/assets/js/28.50d68e71.js"><link rel="prefetch" href="/assets/js/29.fd64a2e5.js"><link rel="prefetch" href="/assets/js/3.85a437da.js"><link rel="prefetch" href="/assets/js/30.57743674.js"><link rel="prefetch" href="/assets/js/32.74fa6a64.js"><link rel="prefetch" href="/assets/js/33.0ea98229.js"><link rel="prefetch" href="/assets/js/34.4efe18bd.js"><link rel="prefetch" href="/assets/js/4.8422bc68.js"><link rel="prefetch" href="/assets/js/5.8b3ff531.js"><link rel="prefetch" href="/assets/js/6.ac5263b0.js"><link rel="prefetch" href="/assets/js/7.7883cabe.js"><link rel="prefetch" href="/assets/js/8.ddd2a348.js"><link rel="prefetch" href="/assets/js/9.5206c4fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8e89f972.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xwine</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/program/" class="nav-link router-link-active">编程</a></div><div class="nav-item"><a href="/zh/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/zh/maps/" class="nav-link">思维导图</a></div><div class="nav-item"><a href="/zh/config/" class="nav-link">快速配置</a></div> <a href="https://github.com/xwine" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/program/" class="nav-link router-link-active">编程</a></div><div class="nav-item"><a href="/zh/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/zh/maps/" class="nav-link">思维导图</a></div><div class="nav-item"><a href="/zh/config/" class="nav-link">快速配置</a></div> <a href="https://github.com/xwine" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/program/computer.html" class="sidebar-link">计算机系统</a></li><li><a href="/zh/program/mysql.html" class="sidebar-link">mysql</a></li><li><a href="/zh/program/spring-ioc.html" class="sidebar-link">spring-ioc</a></li><li><a href="/zh/program/spring-aop.html" class="active sidebar-link">spring-aop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#疑问？？？" class="sidebar-link">疑问？？？</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#面向过程，面向对象，面向切面编程？" class="sidebar-link">面向过程，面向对象，面向切面编程？</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#aop的出现要解决什么问题？它是怎么实现的？" class="sidebar-link">aop的出现要解决什么问题？它是怎么实现的？</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#静态代理和动态代理" class="sidebar-link">静态代理和动态代理</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#jdk动态代理和cglib动态代理" class="sidebar-link">JDK动态代理和CGLIB动态代理</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#aop源码跟踪" class="sidebar-link">AOP源码跟踪</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#springaop介绍" class="sidebar-link">SpringAOP介绍</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#joinpoint" class="sidebar-link">JOINPOINT</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#pointcut" class="sidebar-link">POINTCUT</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#advise" class="sidebar-link">ADVISE</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#aspect" class="sidebar-link">ASPECT</a></li><li class="sidebar-sub-header"><a href="/zh/program/spring-aop.html#织入" class="sidebar-link">织入</a></li></ul></li><li><a href="/zh/program/jdk.html" class="sidebar-link">jdk</a></li><li><a href="/zh/program/sso.html" class="sidebar-link">sso</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-aop"><a href="#spring-aop" aria-hidden="true" class="header-anchor">#</a> spring-aop</h1> <h2 id="疑问？？？"><a href="#疑问？？？" aria-hidden="true" class="header-anchor">#</a> 疑问？？？</h2> <ul><li>面向过程，面向对象，面向切面编程？</li> <li>aop的出现要解决什么问题？</li> <li>aop和aspectj的区别？</li> <li>静态代理和动态代理的区别？</li> <li>aop除了方法切面以外，有什么高级特性？</li> <li>什么是面向切面编程？</li> <li>aop源码有什么可改造点和设计亮点？</li> <li>cglib是什么东西？有什么用？</li> <li>如何记住aop相关知识点？</li></ul> <h2 id="面向过程，面向对象，面向切面编程？"><a href="#面向过程，面向对象，面向切面编程？" aria-hidden="true" class="header-anchor">#</a> 面向过程，面向对象，面向切面编程？</h2> <blockquote><p>软件开发追求的到底是什么？简单，可复用，可扩展？
面向过程的软件开发：思考的是整个软件有哪些过程。过程都是怎样？
面向对象的软件开发：思考的是有哪些东西可以抽象成对象。
面向切面的软件开发：哪些功能可以以切面方式植入。
面向对象是面向过程的抽象，而面向切面是面向对象的抽象。</p></blockquote> <h2 id="aop的出现要解决什么问题？它是怎么实现的？"><a href="#aop的出现要解决什么问题？它是怎么实现的？" aria-hidden="true" class="header-anchor">#</a> aop的出现要解决什么问题？它是怎么实现的？</h2> <blockquote><p>功能需求之外的服务，比如日志，错误异常处理，监控，事务处理等，aop能将这些服务与业务功能进行减耦。同时能够复用相同服务代码。</p></blockquote> <h2 id="静态代理和动态代理"><a href="#静态代理和动态代理" aria-hidden="true" class="header-anchor">#</a> 静态代理和动态代理</h2> <blockquote><p>静态代理中，会为每个被代理的类写一个代理类，在代理类里面再调用被代理类。缺点是复用性差
动态代理是jdk1.3以后，使用运行时字节码生成技术生成代理类，利用反射将原始类和方法当作参数传递给InvokationHandller 所有被代理的方法统一交给ih的invoke方法处理。</p></blockquote> <h2 id="jdk动态代理和cglib动态代理"><a href="#jdk动态代理和cglib动态代理" aria-hidden="true" class="header-anchor">#</a> JDK动态代理和CGLIB动态代理</h2> <blockquote><ul><li>JDK： 基于反射机制进行字节码生成，优点：生成代理速度快，缺点：基于接口，非接口不能用JDK动态代理，使用反射，程序执行效率比较低。</li> <li>CGLIB：采用继承的方式，对生成后的字节码文件进行了优化，程序性能更好。</li></ul></blockquote> <h2 id="aop源码跟踪"><a href="#aop源码跟踪" aria-hidden="true" class="header-anchor">#</a> AOP源码跟踪</h2> <blockquote><p>AopNamespaceHandler
AspectJAutoProxyBeanDefinitionParser</p></blockquote> <ul><li>DefaultAopProxyFactory</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token class-name">AopProxy</span> <span class="token function">createAopProxy</span><span class="token punctuation">(</span><span class="token class-name">AdvisedSupport</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AopConfigException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果配置optimize和target-class，或者要代理的bean没有实现接口的话，</span>
        <span class="token comment">// 采用cglib代理，否则使用JDK动态代理</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isOptimize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> config<span class="token punctuation">.</span><span class="token function">isProxyTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">hasNoUserSuppliedProxyInterfaces</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//这里主要防止获取不到类对象，比如final标示的对象</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>targetClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AopConfigException</span><span class="token punctuation">(</span><span class="token string">&quot;TargetSource cannot determine target class: &quot;</span> <span class="token operator">+</span>
						<span class="token string">&quot;Either an interface or a target is required for proxy creation.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
            <span class="token comment">//如果目标是个接口的化，还是采用JDK动态代理方式</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>targetClass<span class="token punctuation">.</span><span class="token function">isInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">isProxyClass</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdkDynamicAopProxy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ObjenesisCglibAopProxy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdkDynamicAopProxy</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><h2 id="springaop介绍"><a href="#springaop介绍" aria-hidden="true" class="header-anchor">#</a> SpringAOP介绍</h2> <p>@Aspect、@Pointcut、@Before、@After 等注解都是来自于 AspectJ，但是功能的实现是纯 Spring AOP 自己实现的。</p> <h2 id="joinpoint"><a href="#joinpoint" aria-hidden="true" class="header-anchor">#</a> JOINPOINT</h2> <p>指的就是方法调用（构造方法，set，get，正常方法）
SpringAOP仅支持方法级别的JOINPOINT</p> <h2 id="pointcut"><a href="#pointcut" aria-hidden="true" class="header-anchor">#</a> POINTCUT</h2> <p>要匹配的joinpint，通过相应的表达式进行匹配</p> <h2 id="advise"><a href="#advise" aria-hidden="true" class="header-anchor">#</a> ADVISE</h2> <p>具体切面代码都在这里，包括before，throw，after，invoke</p> <h2 id="aspect"><a href="#aspect" aria-hidden="true" class="header-anchor">#</a> ASPECT</h2> <p>它代表容器，包含多个pointcut和advise</p> <h2 id="织入"><a href="#织入" aria-hidden="true" class="header-anchor">#</a> 织入</h2> <p>ProxyFactory</p> <p>##OOP与AOP
用oop，想要实现日志记录和监控等功能，首先想到可能是继承，或者组合，比如售后部分系统业务类继承DebugService，JMQService等，为了进行日志记录，但是这样违背了oop的设计理念。于是aop诞生了。。。
aop最初采用静态代理方式，为每个符合pointcut的类生成相应的代理类。但是这样会导致，joinpoint相同，目标对象类型不一样，会建立很多的代理对象。于是动态代理诞生了。。。
动态代理分为 JDK提供的动态代理和cglib动态代理，二者互补，jdk只能代理实现接口的类，cglib只能代理非final类型的类，spring默认采用jdk动态代理（大概是jdk性能更好一些）</p> <p>spring aop  开发完joinpoint  开发完advise  配置pointcut， 动态代理生成代理类， 在运行时期：</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xwine/edit/master/docs/zh/program/spring-aop.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/3/19 下午12:06:53</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/program/spring-ioc.html" class="prev">spring-ioc</a></span> <span class="next"><a href="/zh/program/jdk.html">jdk</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e3e8a4f2.js" defer></script><script src="/assets/js/2.53d3f055.js" defer></script><script src="/assets/js/31.029347d6.js" defer></script>
  </body>
</html>
