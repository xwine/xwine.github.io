<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql | xwine</title>
    <meta name="description" content="THE BEST TIME IS NOW">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.8e89f972.css" as="style"><link rel="preload" href="/assets/js/app.e3e8a4f2.js" as="script"><link rel="preload" href="/assets/js/2.53d3f055.js" as="script"><link rel="preload" href="/assets/js/29.fd64a2e5.js" as="script"><link rel="prefetch" href="/assets/js/10.eed22b54.js"><link rel="prefetch" href="/assets/js/11.20d4dce6.js"><link rel="prefetch" href="/assets/js/12.df3d0fb3.js"><link rel="prefetch" href="/assets/js/13.e7adab27.js"><link rel="prefetch" href="/assets/js/14.f0924b76.js"><link rel="prefetch" href="/assets/js/15.00601bcd.js"><link rel="prefetch" href="/assets/js/16.431f60c9.js"><link rel="prefetch" href="/assets/js/17.6cd51b48.js"><link rel="prefetch" href="/assets/js/18.9992f2f3.js"><link rel="prefetch" href="/assets/js/19.f9056bf7.js"><link rel="prefetch" href="/assets/js/20.b7c10170.js"><link rel="prefetch" href="/assets/js/21.a33bf179.js"><link rel="prefetch" href="/assets/js/22.55e0d477.js"><link rel="prefetch" href="/assets/js/23.25460b11.js"><link rel="prefetch" href="/assets/js/24.81c7b086.js"><link rel="prefetch" href="/assets/js/25.f1f12557.js"><link rel="prefetch" href="/assets/js/26.3fe0f6a4.js"><link rel="prefetch" href="/assets/js/27.9e45af44.js"><link rel="prefetch" href="/assets/js/28.50d68e71.js"><link rel="prefetch" href="/assets/js/3.85a437da.js"><link rel="prefetch" href="/assets/js/30.57743674.js"><link rel="prefetch" href="/assets/js/31.029347d6.js"><link rel="prefetch" href="/assets/js/32.74fa6a64.js"><link rel="prefetch" href="/assets/js/33.0ea98229.js"><link rel="prefetch" href="/assets/js/34.4efe18bd.js"><link rel="prefetch" href="/assets/js/4.8422bc68.js"><link rel="prefetch" href="/assets/js/5.8b3ff531.js"><link rel="prefetch" href="/assets/js/6.ac5263b0.js"><link rel="prefetch" href="/assets/js/7.7883cabe.js"><link rel="prefetch" href="/assets/js/8.ddd2a348.js"><link rel="prefetch" href="/assets/js/9.5206c4fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8e89f972.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xwine</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/program/" class="nav-link router-link-active">编程</a></div><div class="nav-item"><a href="/zh/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/zh/maps/" class="nav-link">思维导图</a></div><div class="nav-item"><a href="/zh/config/" class="nav-link">快速配置</a></div> <a href="https://github.com/xwine" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/program/" class="nav-link router-link-active">编程</a></div><div class="nav-item"><a href="/zh/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/zh/maps/" class="nav-link">思维导图</a></div><div class="nav-item"><a href="/zh/config/" class="nav-link">快速配置</a></div> <a href="https://github.com/xwine" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/program/computer.html" class="sidebar-link">计算机系统</a></li><li><a href="/zh/program/mysql.html" class="active sidebar-link">mysql</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/program/mysql.html#innodb存储引擎" class="sidebar-link">InnoDB存储引擎</a></li><li class="sidebar-sub-header"><a href="/zh/program/mysql.html#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/zh/program/mysql.html#索引使用" class="sidebar-link">索引使用</a></li></ul></li><li><a href="/zh/program/spring-ioc.html" class="sidebar-link">spring-ioc</a></li><li><a href="/zh/program/spring-aop.html" class="sidebar-link">spring-aop</a></li><li><a href="/zh/program/jdk.html" class="sidebar-link">jdk</a></li><li><a href="/zh/program/sso.html" class="sidebar-link">sso</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql"><a href="#mysql" aria-hidden="true" class="header-anchor">#</a> mysql</h1> <h2 id="innodb存储引擎"><a href="#innodb存储引擎" aria-hidden="true" class="header-anchor">#</a> InnoDB存储引擎</h2> <h3 id="行记录格式"><a href="#行记录格式" aria-hidden="true" class="header-anchor">#</a> 行记录格式</h3> <p>行溢出 如果一个列中存储 的数据不大于8098个字节，那就不会发生行溢出
delete_mask 标示数据是否被删除</p> <ol><li><p>InnoDB为了不同的目的而设计了不同类型的⻚，我们把用于存 放记录的⻚叫做数据⻚。</p></li> <li><p>一个数据⻚可以被大致划分为7个部分，分别是
File Header，表示⻚的一些通用信息，占固定的38字 节。
Page Header，表示数据⻚专有的一些信息，占固定的 56个字节。
Infimum + Supremum，两个虚拟的伪记录，分别表示 ⻚中的最小和最大记录，占固定的26个字节。
User Records:真实存储我们插入的记录的部分，大 小不固定。
Free Space:⻚中尚未使用的部分，大小不确定。 Page Directory:⻚中的某些记录相对位置，也就是 各个槽在⻚面中的地址偏移量，大小不固定，插入的记录 越多，这个部分占用的空间越多。
File Trailer:用于检验⻚是否完整的部分，占用固 定的8个字节。</p></li> <li><p>每个记录的头信息中都有一个next_record属性，从而使⻚ 中的所有记录串联成一个单链表。</p></li> <li><p>InnoDB会为把⻚中的记录划分为若干个组，每个组的最后一 个记录的地址偏移量作为一个槽，存放在Page Directory 中，所以在一个⻚中根据主键查找记录是非常快的，分为两 步:
通过二分法确定该记录所在的槽。
通过记录的next_record属性遍历该槽所在的组中的各个 记录。</p></li> <li><p>每个数据⻚的File Header部分都有上一个和下一个⻚的编 号，所以所有的数据⻚会组成一个双链表。</p></li> <li><p>为保证从内存中同步到磁盘的⻚的完整性，在⻚的首部和尾部 都会存储⻚中数据的校验和和⻚面最后修改时对应的LSN值， 如果首部和尾部的校验和和LSN值校验不成功的话，就说明同 步过程出现了问题。</p></li></ol> <h2 id="索引"><a href="#索引" aria-hidden="true" class="header-anchor">#</a> 索引</h2> <ol><li><p>对于InnoDB存储引擎来说，在单个⻚中查找某条记录分为两 种情况:
以主键为搜索条件，可以使用Page Directory通过二 分法快速定位相应的用户记录。
以其他列为搜索条件，需要按照记录组成的单链表依次遍 历各条记录。</p></li> <li><p>没有索引的情况下，不论是以主键还是其他列作为搜索条件， 只能沿着⻚的双链表从左到右依次遍历各个⻚。</p></li> <li><p>InnoDB存储引擎的索引是一棵B+树，完整的用户记录都存储 在B+树第0层的叶子节点，其他层次的节点都属于内节点，内 节点里存储的是目录项记录。InnoDB的索引分为两大种:
聚簇索引
以主键值的大小为⻚和记录的排序规则，在叶子节点处存 储的记录包含了表中所有的列。
二级索引
以自定义的列的大小为⻚和记录的排序规则，在叶子节点 处存储的记录内容是列 + 主键。
ALTER TABLE index_demo DROP INDEX idx_c2_c3;</p></li> <li><p>MyISAM存储引擎的数据和索引分开存储，这种存储引擎的索 引全部都是二级索引，在叶子节点处存储的是列 + ⻚号。</p></li></ol> <h2 id="索引使用"><a href="#索引使用" aria-hidden="true" class="header-anchor">#</a> 索引使用</h2> <p>上边只是我们在创建和使用B+树索引的过程中需要注意的一些点， 后边我们还会陆续介绍更多的优化方法和注意事项，敬请期待。本集 内容总结如下:</p> <ol><li>B+树索引在空间和时间上都有代价，所以没事儿别瞎建索引。 2. B+树索引适用于下边这些情况:
全值匹配
匹配左边的列
匹配范围值
精确匹配某一列并范围匹配另外一列
用于排序
用于分组</li> <li>在使用索引时需要注意下边这些事项:
只为用于搜索、排序或分组的列创建索引 为列的基数大的列创建索引
索引列的类型尽量小
可以只对字符串值的前缀建立索引 只有索引列在比较表达式中单独出现才可以适用索引 为了尽可能少的让聚簇索引发生⻚面分裂和记录移位的情 况，建议让主键拥有AUTO_INCREMENT属性。 定位并删除表中的重复和冗余索引 尽量适用覆盖索引进行查询，避免回表带来的性能损耗。</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xwine/edit/master/docs/zh/program/mysql.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2019/11/7 下午4:42:25</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/program/computer.html" class="prev">计算机系统</a></span> <span class="next"><a href="/zh/program/spring-ioc.html">spring-ioc</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e3e8a4f2.js" defer></script><script src="/assets/js/2.53d3f055.js" defer></script><script src="/assets/js/29.fd64a2e5.js" defer></script>
  </body>
</html>
